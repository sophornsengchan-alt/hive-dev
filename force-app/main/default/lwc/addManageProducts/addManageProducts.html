<template>
    <lightning-spinner if:true={showSpinner} alternative-text="Loading" size="medium"></lightning-spinner>
    <!-- Screen Price Book Selector -->
    <template if:true={showPricebookSelector}>
        <lightning-card hide-header="true">
            <div class="slds-clearfix slds-p-around_medium custom-card-header">
                <div class="slds-float_left slds-media__body">
                    <h2 class="slds-card__header-title"><span class="slds-truncate">Choose Price Book</span></h2>
                </div>
            </div>
            <br>
            <div class="slds-p-left_medium">
                <p>{labels.CertilogoPricebookSelectorMessage}</p>
                <br>
                <lightning-input
                    type="search"
                    label="Price Book"
                    value={searchKey}
                    placeholder="Search for a Price Book"
                    onchange={handleSearchKeyChange} class="width_input">
                </lightning-input>
                <template if:true={filteredPriceBooks.length}>
                    <div class="dropdown">
                        <template for:each={filteredPriceBooks} for:item="priceBook">
                            <div key={priceBook.Id} class="dropdown-item" data-id={priceBook.Id} data-name={priceBook.Name} onclick={handlePriceBookSelect}>
                                {priceBook.Name}
                            </div>
                        </template>
                    </div>
                </template>
            </div>
            <div slot="footer">
                <lightning-button label={labels.lwcCancelbtn} onclick={handleCancel} variant="neutral" class="slds-m-right_small"></lightning-button>
                <lightning-button label={labels.Next} onclick={handlePricebookNext} variant="brand" disabled={isNextDisabled}></lightning-button>
            </div>
        </lightning-card>
    </template>

    <!-- Screen Product Selector -->
    <template if:true={showProductSelector}>
        <lightning-card hide-header="true">
            <div class="slds-clearfix slds-p-around_medium custom-card-header">
                <div class="slds-float_left slds-media__body">
                    <h2 class="slds-card__header-title"><span class="slds-truncate">Product Selector</span></h2>
                </div>
            </div>

            <div class="slds-grid slds-wrap">
                <div class="slds-col slds-large-size_4-of-12 slds-medium-size_4-of-12 slds-size_4-of-12">
                    <div class="slds-p-around_medium ">
                        <lightning-input type="text" message-when-too-short="Please enter alteast 3 characters to search"
                        label="Enter a Product Code/Description/Name" placeholder="type here..." minlength="3" onchange={handleProductNameInputChange}></lightning-input>
                    </div>
                </div>
                <div class="slds-col slds-large-size_4-of-12 slds-medium-size_4-of-12 slds-size_4-of-12">
                    <div class="slds-p-around_medium">
                            <lightning-combobox 
                            name="productFamily"
                            label="Product Family"
                            value={prodFamilySelectedValue}
                            placeholder="Select Product Family"
                            options={prodFamilyoptions}
                            onchange={handleProdFamilyChange} >
                        </lightning-combobox>
                    </div>
                </div>
            </div>

            <!--product data table-->
            <div class="height_datatable_250">
                <lightning-datatable
                    key-field="productId"
                    data={productDataList}
                    columns={productColumn}
                    onrowselection={handleRowSelection}>
                </lightning-datatable>
            </div>
            <div class="slds-clearfix" slot="footer">
                <div class="slds-float_right">
                    <lightning-button label={labels.lwcCancelbtn} onclick={handleCancel} variant="neutral" class="slds-m-right_small"></lightning-button>
                    <lightning-button label={labels.Next} variant="brand"  onclick={handleProductSelectorNext}></lightning-button>
                </div>
            </div>
        </lightning-card>
    </template>

    <!-- Screen Product Configurator -->
    <template if:true={showProductConfigurator}>
        <c-certilogo-product-configuration
                opportunity-id={oppId}
                pricebook-id={selectedPriceBookId}
                pb-entries={selectedData}
                onclose={handleClose} 
                onopenproductselector={handleOpenProdSelection}
                is-launched-from-prod-selector={clickedOnProdSelectorNext}>
            </c-certilogo-product-configuration>
    </template>  
     
</template>